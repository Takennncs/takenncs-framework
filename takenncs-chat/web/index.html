<!DOCTYPE html>
<html class="scroll-smooth">
   <head>
        <meta charset="utf-8">
        <title>Chat</title>
        <link href="vendor/latofonts.css" rel="stylesheet">
        <link href="vendor/flexboxgrid.6.3.1.min.css" rel="stylesheet"></link>
        <link href="vendor/animate.3.5.2.min.css" rel="stylesheet"></link>
        <link href="css/style.css" rel="stylesheet"></link>
        <script src="vendor/vue.2.3.3.min.js" type="text/javascript"></script>
        <script src="js/config.default.js" type="text/javascript"></script>
        <script src="js/config.js" type="text/javascript"></script>
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
   </head>
   <body class="text-white">
        <div id="app"></div>

        <script type="text/x-template" id="app_template">
            <div id="app">
              <div class="absolute top-5 left-4 w-2/3 h-72" :style="this.style" :class="{ 'fadeOutUp animated': !showWindow, 'hidden': shouldHide }">
                <div class="relative h-full">
                  <div class="messages-container h-full overflow-y-auto mb-5" ref="messages">
                    <message v-for="(msg, index) in messages"
                             :templates="templates"
                             :multiline="msg.multiline"
                             :args="msg.args"
                             :color="msg.color"
                             :template="msg.template"
                             :template-id="msg.templateId"
                             :key="index">
                    </message>
                  </div>
                </div>
                
                <div class="absolute w-full" v-show="showInput">
                  <input
                    v-model="message"
                    ref="input"
                    type="text"
                    placeholder="/ KÃ¤skluse kasutamine"
                    autofocus
                    spellcheck="false"
                    @keyup.esc="hideInput"
                    @keyup="keyUp"
                    @keydown="keyDown"
                    @keypress.enter.prevent="send"
                    class="bg-gray-800/85 bg-opacity-100 border border-gray-700 shadow block p-3 w-2/3 text-sm resize-none outline-none mb-1 h-min rounded-lg flex"
                  ></input>
                  <suggestions :message="message" :suggestions="suggestions"></suggestions>
                </div>
              </div>
            </div>
          </script>
        

        <script type="text/x-template" id="message_template">
            <div class="msg" :class="{ multiline }">
                <span v-html="textEscaped"></span>
            </div>
        </script>

        <script type="text/x-template" id="suggestions_template">
            <div class="suggestions-wrap" v-show="currentSuggestions.length > 0">
                <ul class="bg-gray-800/85 bg-opacity-100 shadow block p-2 text-sm w-2/3 h-min">
                    <li class="mb-1" v-for="s in currentSuggestions">
                        <p>
                            <span>{{s.name}}</span>
                            <span class="param" v-for="(p, index) in s.params">[{{p.name}}]</span>
                        </p>
                        
                        <small class="help">
                            <template v-if="!s.disabled">
                                {{s.help}}
                            </template>
                            <template v-for="p in s.params" v-if="!p.disabled">
                                {{p.help}}
                            </template>
                        </small>
                    </li>
                </ul>
            </div>
        </script>

        <script type="text/javascript" src="./js/Suggestions.js"></script>
        <script type="text/javascript" src="./js/Message.js"></script>
        <script type="text/javascript" src="./js/App.js"></script>

        <script type="text/javascript">
            window.post = (url, data) => {
                var request = new XMLHttpRequest();
                request.open('POST', url, true);
                request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
                request.send(data);
            }
            
            const instance = new Vue({
                el: '#app',
                render: h => h(APP),
            });
            
            window.emulate = (type, detail = {}) => {
                detail.type = type;

                window.dispatchEvent(new CustomEvent('message', {
                    detail,
                }));
            };
        </script>
   </body>
</html>